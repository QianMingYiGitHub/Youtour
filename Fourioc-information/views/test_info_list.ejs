<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>编辑</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.min.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap-table.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/dateSelect.css">
  <script type="text/javascript" src="/javascripts/jquery-2.1.1-youtu.js"></script>
  <script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>
  <script type="text/javascript" src="/javascripts/bootstrap-table.js"></script>
  <script type="text/javascript" src="/javascripts/bootstrap-table-zh-CN.js"></script>
  <script type="text/javascript" src="/javascripts/dateSelect.js"></script>
  <style type="text/css">
    .main{
      margin:0 auto 0 auto;

    }
    .button_top{
      width: 100%;
      margin-top: 15px;
      margin-bottom: 15px;
    }
    .class_box_l{
      margin: 0 auto 0 auto;
      height: 100px;
      line-height: 34px;

    }
    .class_box_l b{
      width: 100%;
      float: left;
      font-size: 18px;
      text-align: center;
      display: block;
      margin: 0 auto 0 auto;

    }
    .class_box_center{
      width: 100%;
      margin: 0 auto 0 auto;
      height: 100%;
    }
    .class_box_l span{
      float: left;
      font-size: 16px;
      font-weight: bold;
      margin-left: 60px;


    }
    .class_box_l p{
      float: left;
      font-size: 16px;
    }
    .relatives_example{
      width: 100%;
      color: red;
    }
    .kong{
      width: 80px;
      text-align: center;
      margin-left: 40px;
    }
    .explain_foot{
      width: 545px;
      height: 35px;
      line-height: 35px;
      float:right;
      border: 1px #eee solid;
    }
    .explain_foot a{
      width: 10px;
      height: 10px;
      float: left;
      display: block;
      margin-left: 10px;
      margin-top: 12px;
    }
    .explain_foot span{
      float: left;
      margin-left: 5px;
    }


    .green{
      background-color: #4cae4c;
    }
    .red{
      background-color: tomato;
    }
    .blue{
      background-color: #00B7FF;
    }
    .gray{
      background-color: #9d9d9d;
    }




    .panel-body {
      padding: 5px 10px 10px 10px;
    }
    .magnifier_img{
      padding-bottom: 3px;
      margin-right: 7px;

    }
    .query_button{
      width: 140px;
      float: right;
      margin-right: 5px;
    }
    .query_top_box{
      width: 100%;
      height: 128px;
      border: 1px solid #dddddd;
      padding-top: 20px;;
    }
    .button_width{
      width: 90px;
    }
.box_top{
  margin-top: 15px;
}

    .col-md-10{
      padding-left: 0px;
      padding-right: 0px;
    }
    body{
      font-size: 16px;
      font-family: "微软雅黑";
    }
    .query_column{
      margin-top: 8px;;
    }
    .input-group-addon:last-child {
      border-left: 0;
      width: 90px;
      float: initial;
    }
    .input-group{
      width: 100%;
    }
    .btn-primary{
      background-color: #06afe6;
      border-color: #06afe6;
    }
    .pagination>.active>a,
    .pagination>.active>span,
    .pagination>.active>a:hover,
    .pagination>.active>span:hover,
    .pagination>.active>a:focus,
    .pagination>.active>span:focus{
      background-color: #06afe6;
      border-color: #06afe6;
    }
    label{
      color: #777;
    }
    .th-inner{
      color: #777;
    }
    .modal-footer{
      text-align: center;
    }
    @media (min-width: 768px) {
      .modal-dialog {
        width: 500px;
        margin: 30px auto;
      }
    }
    .modal-header{
      background-color: #03ACE3;
      color: #fff;
      height: 40px;
    }
    .modal-title{
      line-height: 10px;
      font-size: 16px;
    }
    .close{
      color: #fff;
      opacity: .9;
      line-height: 0.6;
    }
    .table>thead>tr>th{
      border-bottom:0px;
    }
    .col-md-6{
      padding-left: 0px;
      padding-right: 5px;
    }
    .col-md-7{
      padding-left: 0px;
      padding-right: 5px;
    }
    .col-md-5{
      padding-left: 0px;
      padding-right: 5px;
    }
    .table{
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<div class="main">
  <div class="container-fluid">

    <div class="form-inline" >
      <div class="col-md-12 query_top_box" >

        <div class="col-md-12" >
        <div class="form-group">
          <label  for="student_name">学生姓名：</label>

          <input type="text" class="form-control" style="width: 210px;" id="student_name" placeholder="请输入学生姓名">

        </div>
        <div class="form-group">
          <label class="kong" for="student_mobile">手机号：</label>

          <input type="text" class="form-control" style="width: 210px;" id="student_mobile" placeholder="请输入手机号">

        </div>

        <div class="form-group">
          <label class="kong" for="student_time">&nbsp&nbsp&nbsp&nbsp日历：</label>

          <input type="text" class="form-control" style="width: 210px;" id="student_time" placeholder="请输入日期">

        </div>
        </div>

        <div class="col-md-12 box_top" >
        <div class="form-group">
          <label class="" for="student_grade">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp年级：</label>
          <select class="form-control"   id="select_grade" name="select_grade" style="width: 210px;" onchange="teacher_grade(this.options[this.options.selectedIndex].value)">
            <option value="9999">请选择年级</option>
            <option value="0">一年级</option>
            <option value="1">二年级</option>
            <option value="2">三年级</option>
            <option value="3">四年级</option>
            <option value="4">五年级</option>
            <option value="5">六年级</option>
            <option value="6">七年级</option>
            <option value="7">八年级</option>
            <option value="8">九年级</option>
            <option value="9">高一</option>
            <option value="10">高二</option>
            <option value="11">高三</option>
          </select>

        </div>


        <div class="form-group">
          <label class="kong" for="student_class">&nbsp&nbsp&nbsp班级：</label>
          <select class="form-control" id="select_class" name="select_class" style="width: 210px;">
            <option value="9999">请选择班级</option>
          </select>

        </div>
          <button  class="btn btn-primary query_button" id="query_case"><img  src="../images/magnifier.png" class="magnifier_img"/>查询</button>
</div>

        <!--<div class="form-group">-->
        <!--<label class="kong" for="query_incident_area">案件地区：</label>-->

        <!--<input type="text" class="form-control" style="width: 210px;" id="query_incident_area" placeholder="案件地区">-->

        <!--</div>-->

      </div>

    </div>

    <div class="col-md-10 button_top">
      <!--<button type="button" class="btn btn-primary" id="add_teacher">新增</button>-->
      <!--<button type="button" class="btn btn-primary" id="edit_teacher">编辑</button>-->
      <!--<button type="button" class="btn btn-primary" id="delete_teacher">删除</button>-->


      <!--<div class="explain_foot">-->
      <!--<a class="green"></a><span>绿色代表答对</span>-->
      <!--<a class="red"></a><span>红色代表答错</span>-->
      <!--<a class="blue"></a><span>蓝色代表无效作答</span>-->
      <!--<a class="gray"></a><span>灰色代表未作答</span>-->
      <!--</div>-->

    </div>





    <div class="col-md-10">
    </div>
    <table id="table">

    </table>

  </div>
</div>

<!-- Moda3 -->
<div class="modal fade" id="delete_modal"  tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">删除教师</h4>
      </div>
      <div class="modal-body text-center">
        确定删除教师及其所有信息？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default button_width" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary button_width" id="delete_teacher_submit">确定</button>
      </div>
    </div>
  </div>
</div>
<input id="box_data" type="hidden"/>
<!--编辑老师ID-->
<input id="edit_teacher_input" type="hidden"/>

<!--编辑时，原手机号-->
<input id="edit_mobile" type="hidden"/>

<!--编辑时，原姓名-->
<input id="edit_name_input" type="hidden"/>

</body>
<script type="text/javascript">
  $("#student_time").dateSelect();

  $(function(){
    var class_id=$.intercept_url("class_id");
    var school_id=$.intercept_url("school_id");
   // alert(school_id);
    if(class_id=="abc"){
      $.ajax({
        url: '/school/get_school_puch',
        type: 'post',
        dataType: 'json',
        contentType: "application/json",
        data: JSON.stringify({
          school_id:school_id
        }),
        success: function (data) {
          if(data.success==0){
            //alert(JSON.stringify(data));
            var jsondata=JSON.parse(JSON.stringify(data));

            var content=jsondata.data.Puch;
            //    alert(JSON.stringify(content));
            $("#box_data").val(JSON.stringify(content));
            table_data();
          }else if(data.success==1){
            //alert(JSON.stringify(data));
            var jsondata=JSON.parse(JSON.stringify(data));

            var content=jsondata.data.Puch;
            //    alert(JSON.stringify(content));
            $("#box_data").val(JSON.stringify(content));
            table_data();
      }
          else {
            alert("获取数据失败");
          }

        },
        error: function(){
          alert("获取数据失败");
        }
      });

    }else{
//alert("班主任");
      $("#select_grade").attr('disabled',"disabled");
      $("#select_class").attr('disabled',"disabled");
      var school_id=$.intercept_url("school_id");
      var class_id=$.intercept_url("class_id");
    //  alert(class_id);
      $.ajax({
        url: '/school/get_class_puch',
        type: 'post',
        dataType: 'json',
        contentType: "application/json",
        data: JSON.stringify({
          school_id:school_id,
          class_id:class_id
        }),
        success: function (data) {
          if(data.success==0){

            var jsondata=JSON.parse(JSON.stringify(data));
          //  alert(JSON.stringify(data));
            var content=jsondata.data.Puch;
            //    alert(JSON.stringify(content));
            $("#box_data").val(JSON.stringify(content));
            table_data();
          }else if(data.success==1){
            //alert(JSON.stringify(data));
            var jsondata=JSON.parse(JSON.stringify(data));

            var content=jsondata.data.Puch;
            //    alert(JSON.stringify(content));
            $("#box_data").val(JSON.stringify(content));
            table_data();
          }
          else {

            alert("获取数据失败1");
          }
        },
        error: function(){
          alert("获取数据失败2");
        }
      });

    }
  });


  $("#query_case").on('click',function(){
    var school_id=$.intercept_url("school_id");
    var class_id=$.intercept_url("class_id");
    var  student_name=$.filterSpaces($("#student_name").val());
    var  student_mobile=$.filterSpaces($("#student_mobile").val());
    var  student_time=$.filterSpaces($("#student_time").val());
    var  select_grade=$("#select_grade option:selected").val();
    var  select_class=$("#select_class option:selected").val();

//    if(student_mobile.length!=0){
//      if($.cell_phone(student_mobile)==false){
//        alert("输入手机格式不正确");
//        return
//      }
//    }

    if(student_name.length==0&&student_mobile.length==0&&student_time.length==0&&select_grade=="9999"&&select_class=="9999"){
      alert("请输入查询条件");
      return false
    }else if(select_grade=="9999"){
      select_grade="";
    }else if(select_class=="9999"){
      select_class="";
    }else if(select_class=="暂无班级"){
      select_class="";
    }
    if(select_grade=="9999"){
      select_grade="";
    }
    if(select_class=="9999"){
      select_class="";
    }
    if(select_class=="暂无班级"){
      select_class="";
    }

//    alert(student_name);
//    alert(student_mobile);
//    alert(student_time);
//    alert(select_grade);
//    alert(select_class);

    if(class_id=="abc"){
      var class_id="";
      $('#table').bootstrapTable('destroy');
      var school_id=$.intercept_url("school_id");
      $.ajax({
       url: '/school/query_school_student',
       type: 'post',
       dataType: 'json',
       contentType: "application/json",
       data: JSON.stringify({
       school_id:school_id,
       student_name_query:student_name,//学生名字
       puch_time:student_time,
       class_m:select_class,
       id:class_id,
          student_phone:student_mobile

        }),
        success: function(data){
          if(data.success==0){
           // alert(data.success);
            var jsondata=JSON.parse(JSON.stringify(data));
            //alert(JSON.stringify(data));
            var   allteacher=jsondata.data.Puch;
            $("#box_data").val(JSON.stringify(allteacher));

            //  var table_data2 =jsondata.data.Cases;
          //  var table_data = JSON.parse($("#box_data").val());

            table_data()

          }
          else if(data.success==1){
            var jsondata=JSON.parse(JSON.stringify(data));
           // alert(JSON.stringify(data));
            var   allteacher=jsondata.data.Puch;
            $("#box_data").val(JSON.stringify(allteacher));
            table_data()
          }
          else{
            //alert(data.desc)
            alert("提交数据失败1");
          }
        },
        error: function(){
          alert("提交数据失败2");
        }

      })
    }else{

      $('#table').bootstrapTable('destroy');
      var school_id=$.intercept_url("school_id");
      $.ajax({
        url: '/school/query_class_student',
        type: 'post',
        dataType: 'json',
        contentType: "application/json",
        data: JSON.stringify({
          school_id:school_id,
          student_name_query:student_name,//学生名字
          puch_time:student_time,
          class_m:select_class,
          class_id:class_id,
          student_phone:student_mobile
        }),
        success: function(data){
          if(data.success==0){
            // alert(data.success);
            var jsondata=JSON.parse(JSON.stringify(data));
            //alert(JSON.stringify(data));
            var   allteacher=jsondata.data.Puch;
            $("#box_data").val(JSON.stringify(allteacher));

            //  var table_data2 =jsondata.data.Cases;
            //  var table_data = JSON.parse($("#box_data").val());

            table_data()

          }
          else if(data.success==1){
            var jsondata=JSON.parse(JSON.stringify(data));
            // alert(JSON.stringify(data));
            var   allteacher=jsondata.data.Puch;
            $("#box_data").val(JSON.stringify(allteacher));
            table_data()
          }
          else{
          //  alert(data.desc)
            alert("提交数据失败1");
          }
        },
        error: function(){
          alert("提交数据失败2");
        }

      })

    }

  });




//  function department_list(){
//    var school_id=$.intercept_url("school_id");
//    var department_teacher=$.intercept_url("department_name");
//    $('#table').bootstrapTable('destroy');
//    if(department_teacher=="全体教师"){
//      $.ajax({
//        url: '/users/queryallteacher',
//        type: 'post',
//        dataType: 'json',
//        contentType: "application/json",
//        data: JSON.stringify({
//          school_id:school_id
//        }),
//        success: function (data) {
//          if(data.success==0){
//            var jsondata=JSON.parse(JSON.stringify(data));
//            alert(JSON.stringify(data));
//            var content=jsondata.data.Allteacher;
//            //    alert(JSON.stringify(content));
//            $("#box_data").val(JSON.stringify(content));
//            table_data();
//          }else {
//            alert("获取数据失败");
//          }
//
//        },
//        error: function(){
//          alert("获取数据失败");
//        }
//      });
//    }else{
//      var school_id=$.intercept_url("school_id");
//      $.ajax({
//        url: '/users/querydeparteacher',
//        type: 'post',
//        dataType: 'json',
//        contentType: "application/json",
//        data: JSON.stringify({
//          department_name:department_teacher,
//          school_id:school_id
//        }),
//        success: function (data) {
//          if(data.success==0){
//            var jsondata=JSON.parse(JSON.stringify(data));
//            alert(JSON.stringify(data));
//            var content=jsondata.data.Allteacher;
//            //    alert(JSON.stringify(content));
//            $("#box_data").val(JSON.stringify(content));
//            table_data();
//          }else {
//            alert(data.desc);
//            alert("获取数据失败1");
//          }
//        },
//        error: function(){
//          alert("获取数据失败2");
//        }
//      });
//    }
//  }

function teacher_grade(id){
  var school_id=$.intercept_url("school_id");
 // alert(school_id);
  if(id==9999){
    $("#select_class").find("option").remove();
    var select_class = document.getElementById('select_class');
    select_class.add(new Option("请选择班级","9999"));
  }else {
    $.ajax({
      url: '/classes/querytype_Class',
      type: 'post',
      dataType: 'json',
      contentType: "application/json",
      data: JSON.stringify({
        school_id: school_id,
        type_grade: id,
      }),
      success: function (data) {
        if (data.success == 0) {
          //alert(JSON.stringify(data));
          var jsondata = JSON.parse(JSON.stringify(data));

          var content = jsondata.data.Classes;

          var select_class = document.getElementById('select_class');

          if ($.key_value(content) > 0) {
            $("#select_class").find("option").remove();
            for (var i = 0; i < content.length; i++) {
              select_class.add(new Option(content[i].class, content[i].id));
            }
          } else if ($.key_value(content) == 0) {
            $("#select_class").find("option").remove();
            select_class.add(new Option("暂无班级", "暂无班级"));
          }

          //  select1.add(new Option.value(weixin_bank[i] , i));


        } else {
          alert("获取数据失败");
        }

      },
      error: function () {
        alert("获取数据失败2");
      }
    });
  }
}

  function table_data() {
    var table_data = JSON.parse($("#box_data").val());
    // var  table_data=$("box_data").val();
    $table = $('#table').bootstrapTable({

      data: table_data,
      // url: '/table/123',
      // method: 'post',
      dataType: "json",
      //----选填----//
      //设置高度
      height: 500,

      pagination: true,
      pageSize: 10,
      pageList: [5, 10, 15, 20],
      sidePagination: "client",


      pageNumber: 1,
      sortable: true,
      sortOrder: "desc",

      clickToSelect: true,
      striped: true,

      //功能工具
      singleSelect: false,

      searchOnEnterKey: false,

//成功时执行函数
      //       onLoadSuccess:function(data){},
      onLoadSuccess: function (aa, bb, cc) {

      },

      //错误时执行函数
      onLoadError: function (status) {

        alert("错误");
      },


      idField: undefined,
      columns: [
        //附加表头，

        {
          width:40,
          formatter: function (value, row, index) {
            return index + 1;
          }
        },

        {
          //单选
          radio: true,

          //多选
          // checkbox:true,
        },
        {
          title: '学生姓名',
          width:100,
          field: 'student_name',
          align: 'center',
          valign: 'middle',
          //  rowspan: 2

        },
        {
          title: '手机号',
          field: 'student_phone',
          align: 'center',
          valign: 'middle',


        },

        {
          title: '班级',
          field: 'class_name',
          align: 'center',
          valign: 'middle',
//                  formatter: function (value, row, index) {
//                    if (row.headmaster_status == -1) {
//                      var e = '<span>-</span>';
//                      return e
//                    }
//                    if (row.headmaster_status ==1) {
//                      var e = '<span>'+row.class_name+'</span>;'
//                      return e
//                    }
//                    if (row.headmaster_status ==0) {
//                      var e = '<span>'+row.class_name+'</span>;'
//                      return e
//                    }
//
//                  }
        },
        {
          title: '进/出校时间',
          field: 'puch_time',
          align: 'center',
          valign: 'middle',
        },
      ]

    });
  }



</script>
</html>

