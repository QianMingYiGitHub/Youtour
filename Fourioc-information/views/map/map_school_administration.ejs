<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>编辑</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap-table.css"/>
    <link rel="stylesheet" type="text/css" href="/stylesheets/easyui.css">
    <script type="text/javascript" src="/javascripts/jquery-2.1.1-youtu.js"></script>

    <script type="text/javascript" src="/javascripts/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-table.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-table-zh-CN.js"></script>
    <script type="text/javascript" src="/javascripts/area.js"></script>
    <script type="text/javascript" src="/javascripts/china_area.js"></script>
    <style type="text/css">
        .main{
            margin:0 auto 0 auto;

        }
        .button_top{
            width: 100%;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .class_box_l{
            margin: 0 auto 0 auto;
            height: 100px;
            line-height: 34px;

        }
        .class_box_l b{
            width: 100%;
            float: left;
            font-size: 18px;
            text-align: center;
            display: block;
            margin: 0 auto 0 auto;

        }
        .class_box_center{
            width: 100%;
            margin: 0 auto 0 auto;
            height: 100%;
        }
        .class_box_l span{
            float: left;
            font-size: 16px;
            font-weight: bold;
            margin-left: 60px;


        }
        .class_box_l p{
            float: left;
            font-size: 16px;
        }
        .relatives_example{
            width: 100%;
            color: red;
        }
        .kong{

            text-align: center;
            margin-left: 40px;
        }

        .panel-body {
            padding: 5px 10px 10px 10px;
        }
        .magnifier_img{
            padding-bottom: 3px;
            margin-right: 7px;

        }
        .query_button{
            width: 140px;
            float: right;
            margin-right: 5px;
        }
        .query_top_box{
            width: 100%;
            height: 130px;
            border: 1px solid #dddddd;
            padding-top: 20px;;
        }

        .col-md-10{
            padding-left: 0px;
        }
        body{
            font-size: 16px;
            font-family: "微软雅黑";
        }
        .query_column{
            margin-top: 8px;;
        }
        .input-group-addon:last-child {
            border-left: 0;
            width: 90px;
            float: initial;
        }
        .input-group{
            width: 100%;
        }
        .btn-primary{
            background-color: #06afe6;
            border-color: #06afe6;
        }
        .pagination>.active>a,
        .pagination>.active>span,
        .pagination>.active>a:hover,
        .pagination>.active>span:hover,
        .pagination>.active>a:focus,
        .pagination>.active>span:focus{
            background-color: #06afe6;
            border-color: #06afe6;
        }
        label{
            color: #777;
        }
        .th-inner{
            color: #777;
        }
        .school_box{
            margin-top: 20px;
        }
        .modal-header{
            background-color: #03ACE3;
            color: #fff;
            height: 40px;
            border-top-left-radius:6px;
            border-top-right-radius:6px;
        }
        .modal-title{
            line-height: 10px;
            font-size: 16px;
        }
        .close{
            color: #fff;
            opacity: .9;
            line-height: 0.6;
        }
        .col-md-4{
            padding-right: 10px;
             padding-left: 0px;
        }
        .col-md-6{
            padding-right: 10px;
            padding-left: 0px;
        }

        .info_school_box{
            width: 100%;
            margin-top: 15px;
            text-align: center;
        }
        .add_info_school{
            width: 200px;
        }
        .button_width{
            width: 90px;
        }
    </style>
</head>

<body>

<div class="main">
    <div class="container-fluid">

        <div class="form-inline" >
            <div class="col-md-12 query_top_box" >

                <div class="form-group">
                    <label  for="query_case_number">所在省：</label>

                    <select class="form-control" style="width: 210px;" id="selProvince">
                        <option value="0">--请选择省份--</option>
                    </select>

                </div>
                <div class="form-group">
                    <label class="kong" for="query_case_type">市：</label>

                    <select class="form-control" style="width: 210px;" id="selCity">
                        <option value="0">--请选择城市--</option>
                    </select>

                </div>

                <div class="form-group">
                    <label class="kong" for="query_incident_area">区：</label>

                    <select class="form-control" style="width: 210px;" id="selDistrict">
                        <option value="0">--请选择区/县--</option>
                    </select>

                </div>


<div class="school_box" >

    <div class="form-group">
        <label class="" for="query_incident_area">学校名称：</label>

        <input type="text" class="form-control" id="query_school_name" placeholder="请输入学校名称" style="width: 485px;">

    </div>
    <button  class="btn btn-primary query_button" id="query_case"><img  src="../images/magnifier.png" class="magnifier_img"/>查询</button>
</div>



            </div>




        </div>

        <div class="col-md-10 button_top">
            <button type="button" class="btn btn-primary" id="add_school">新增</button>
            <button type="button" class="btn btn-primary" id="edit_school">编辑</button>
            <button type="button" class="btn btn-primary" id="delete_school">删除</button>
            <button type="button" class="btn btn-primary" id="info_school">学校人员信息</button>
            <button type="button" class="btn btn-primary" id="trial_pieces">应用率详情</button>

        </div>

        <div class="col-md-10">
        </div>
        <table id="table">

        </table>

    </div>
</div>


<input type="hidden"  id="delete_school_id"/>

<!-- 学校坐标经度大 -->
<input type="hidden"  id="school_longitude_zero"/>
<!-- 学校坐标伟度小 -->
<input type="hidden"  id="school_latitude_zero"/>



<!-- 学校坐标经度大 -->
<input type="hidden"  id="school_longitude_one"/>
<!-- 学校坐标伟度小 -->
<input type="hidden"  id="school_latitude_one"/>
<!-- 学校名称 -->
<input type="hidden"  id="school_name_one"/>
<!-- 学校管理名字 -->
<input type="hidden"  id="school_admin_one"/>

<!-- 学校管理手机 -->
<input type="hidden"  id="school_mobile_one"/>
<!-- 学校管理手机 -->
<input type="hidden"  id="school_mobile_one"/>


<!-- 学校坐标经度大 -->
<input type="hidden"  id="school_longitude_two"/>
<!-- 学校坐标伟度小 -->
<input type="hidden"  id="school_latitude_two"/>
<!-- 学校名称 -->
<input type="hidden"  id="school_name_two"/>
<!-- 学校管理名字 -->
<input type="hidden"  id="school_admin_two"/>
<!-- 学校管理手机 -->
<input type="hidden"  id="school_mobile_two"/>
<!-- 学校管理手机 -->
<input type="hidden"  id="school_mobile_two"/>


<!-- 学校坐标经度大 -->
<input type="hidden"  id="school_longitude_three"/>
<!-- 学校坐标伟度小 -->
<input type="hidden"  id="school_latitude_three"/>
<!-- 学校名称 -->
<input type="hidden"  id="school_name_three"/>
<!-- 学校管理名字 -->
<input type="hidden"  id="school_admin_three"/>
<!-- 学校管理手机 -->
<input type="hidden"  id="school_mobile_three"/>
<!-- 学校管理手机 -->
<input type="hidden"  id="school_mobile_three"/>



<!-- Modal -->
<div class="modal fade" id="add_school_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">添加校区</h4>
            </div>
            <div class="modal-body">
                <div class="input-group">
                <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-addon">省</span>
                    <select class="form-control add_province" id="add_province" name="add_province">

                    </select>
                </div>
                </div>
                <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-addon">市</span>
                    <select class="form-control add_city" id="add_city" name="add_city">
                    </select>

                </div>
</div>
                <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-addon">区</span>
                    <select class="form-control add_county" id="add_county" name="add_county">

                    </select>

                </div>
</div>
            </div>
</br>
                <div class="input-group">
                    <span class="input-group-addon">学校名称：</span>
                    <input type="text" class="form-control"  id="add_school_name" placeholder="请输入学校名称">

                </div>

                </br>

                <div class="input-group">
                <div class="col-md-6">
<div class="input-group" style="width: 99%;">
    <span class="input-group-addon">学校管理员：</span>
    <input type="text" class="form-control"  id="add_school_admin" placeholder="请输入管理员名字">
</div>
                </div>

                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-addon">管理员手机：</span>
                        <input type="text" class="form-control"  id="add_school_mobile" placeholder="请输入管理员手机">
                    </div>
                </div>
</div>

                <!--<div class="info_school_box">-->
                    <!--<button onclick="add_info_school()" class="btn btn-primary add_info_school">添加学校</button>-->
                <!--</div>-->



                <div class="add_school_box" style="width: 100%;">

                    <div class="input-group">

                        <div class="box col-md-12" style="margin:0;padding:0;border:0;">
                            <div class="box-inner">
                                <div class="box-content">
                                    <table class="table">
                                        <!--<thead>-->
                                        <!--<tr >-->
                                            <!--<th ><span  id="add_school_title">学校学校</span></th>-->
                                          <!---->
                                        <!--</tr>-->
                                        <!--</thead>-->
                                        <tbody id="add_school_info">
                                        <!-- <tr class="active">
                                            <td>部门1</td>
                                            <td>
                                                <a class="btn btn-link" style='color:OrangeRed;' onclick="alert(1);">
                                                    <i class="glyphicon glyphicon-minus icon-white"></i>移出
                                                </a>
                                            </td>
                                        </tr> -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>


                </div>




            </div>




            <div class="modal-footer">
                <button type="button" class="btn btn-default button_width" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary button_width" id="add_school_submit">保存</button>
            </div>
        </div>
    </div>
</div>




<!-- Moda2 -->
<div class="modal fade" id="edit_school_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">编辑学校信息</h4>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-addon">省</span>
                            <select class="form-control" id="edit_selProvince" name="edit_selProvince" >
                                <option value="请选择">请选择</option>
                            </select>

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-addon">市</span>
                            <select class="form-control" id="edit_selCity" name="edit_selCity">
                                <option value="请选择">请选择</option>

                            </select>

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <span class="input-group-addon">区</span>
                            <select class="form-control" id="edit_selDistrict" name="edit_selDistrict">
                                <option value="请选择">请选择</option>

                            </select>

                        </div>
                    </div>
                </div>
                </br>
                <div class="input-group">
                    <span class="input-group-addon">学校名称：</span>
                    <input type="text" class="form-control"  id="edit_school_name" placeholder="请输入学校名称">

                </div>

                </br>

                <div class="input-group">
                    <div class="col-md-6">
                        <div class="input-group" style="width: 99%;">
                            <span class="input-group-addon">学校管理员：</span>
                            <input type="text" class="form-control"  id="edit_school_admin" placeholder="请输入管理员名字">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-addon">管理员手机：</span>
                            <input type="text" class="form-control"  id="edit_school_mobile" placeholder="请输入管理员手机">
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default button_width" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary button_width" id="edit_school_submit">保存</button>
            </div>
        </div>
    </div>
</div>




<!-- 删除 -->
<div class="modal fade" id="delete_school_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document" style="width: 400px">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">删除书签</h4>
            </div>
            <div class="modal-body text-center">
                是否确定删除学校所有信息？
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default button_width" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary button_width" data-dismiss="modal" id="delete_school_submit">删除</button>
            </div>
        </div>
    </div>
</div>


<input id="box_data" type="hidden"/>
<!---修改ID--->
<input id="edit_box_id" type="hidden"/>

<script type="text/javascript">
    $(function(){
        $.ajax({
            url: '/school/get_schoollist',
            type: 'get',
            dataType: 'json',
            contentType: "application/json",
            data: JSON.stringify({
            }),
            success: function (data) {
                if(data.success==0){
                    var jsondata=JSON.parse(JSON.stringify(data));
                      alert(JSON.stringify(data));
                    var content=jsondata.data.School_List;
                    //    alert(JSON.stringify(content));
                    $("#box_data").val(JSON.stringify(content));
                   table_data();
                }else {
                    alert("获取数据失败");
                }

            },
            error: function(){
                alert("获取数据失败");
            }
        });


        //设置默认值
        var option = $("<option>").val("0").text("==请选择省份==");
        $("[name='add_province']").append(option);

        option = $("<option>").val("0").text("==请选择城市==");
        $("[name='add_city']").append(option);

        option = $("<option>").val("0").text("==请选择县区==");
        $("[name='add_county']").append(option);

        //绑定省份
        for (var i = 0; i < areas.length; i++) {
            if (parseInt(areas[i].level) == 1) {
                option = $("<option>").val(areas[i].code).text(areas[i].name);
                $("[name='add_province']").append(option);
            }
        }

        //城市联动
        $("[name='add_province']").bind("change", function() {
            var code = parseInt($(this).val());

            //加载城市
            if (code > 0) {
                $("[name='add_city'] option:gt(0)").remove();
                for (var i = 0; i < areas.length; i++) {
                    if (parseInt(areas[i].parentCode) == code) {
                        option = $("<option>").val(areas[i].code).text(areas[i].name);
                        $("[name='add_city']").append(option);
                    }
                }
            }
            //绘制地图
            if (code > 0) {
                for (var i = 0; i < areas.length; i++) {
                    if (parseInt(areas[i].code) == code) {

                        var longitude = areas[i].longitude;
                        var latitude = areas[i].latitude;
$("#school_longitude_zero").val(longitude);
                        $("#school_latitude_zero").val(latitude);


                        break;
                    }
                }
            }
        });

        //城市联动
        $("[name='add_city']").bind("change", function() {
            var code = parseInt($(this).val());

            //加载县区
            if (code > 0) {
                $("[name='add_county'] option:gt(0)").remove();
                for (var i = 0; i < areas.length; i++) {
                    if (parseInt(areas[i].parentCode) == code) {
                        option = $("<option>").val(areas[i].code).text(areas[i].name);
                        $("[name='add_county']").append(option);
                    }
                }
            }

            //绘制地图
            if (code > 0) {
                for (var i = 0; i < areas.length; i++) {
                    if (parseInt(areas[i].code) == code) {

                        var longitude = areas[i].longitude;
                        var latitude = areas[i].latitude;

                        $("#school_longitude_zero").val(longitude);
                        $("#school_latitude_zero").val(latitude);
                        break;
                    }
                }
            }

        });


        //县区联动
        $("[name='add_county']").bind("change", function() {
            var code = parseInt($(this).val());

            //绘制地图
            if (code > 0) {
                for (var i = 0; i < areas.length; i++) {
                    if (parseInt(areas[i].code) == code) {

                        var longitude = areas[i].longitude;
                        var latitude = areas[i].latitude;

                        $("#school_longitude_zero").val(longitude);
                        $("#school_latitude_zero").val(latitude);
                        break;
                    }
                }
            }
        });

    });


    $("#query_case").on('click',function(){
        var  selProvince=$("#selProvince option:selected").text();
        var  selCity=$("#selCity option:selected").text();
        var  selDistrict=$("#selDistrict  option:selected").text();
        var  query_school_name=$.filterSpaces($("#query_school_name").val());
        if(selProvince.length==0&&selCity.length==0&&selDistrict.length==0&&query_school_name.length==0){
            alert("请输入查询条件");
            return false
        }
        if(selProvince=="--请选择省份--"){
            var query_address="";
        }else if(selCity=="--请选择城市--"){
            var query_address=selProvince;
        }else if(selDistrict=="--请选择区/县--"){
            var query_address=selProvince+selCity;
        }else {
            var query_address=selProvince+selCity+selDistrict;
        }
        alert("钱明一:"+query_address);
        alert(query_school_name);
        $('#table').bootstrapTable('destroy');

        $.ajax({
            url: '/school/query_schoollist',
            type: 'post',
            dataType: 'json',
            contentType: "application/json",
            data: JSON.stringify({
               school_position:query_address,
               school_name :query_school_name
            }),

            success: function(data) {
                alert(data);
                if (data.success == 0) {

                    $("#query_school_name").val("");
                    $("#selProvince option[value='0']").attr("selected", "selected");
                    $("#selCity option[value='0']").attr("selected", "selected");
                    $("#selDistrict option[value='0']").attr("selected", "selected");
                    $("#selProvince option[value='0']").removeAttr("selected");
                    $("#selCity option[value='0']").removeAttr("selected");
                    $("#selDistrict option[value='0']").removeAttr("selected");
                    alert(JSON.stringify(data));
                    var jsondata=JSON.parse(JSON.stringify(data));

if($.isEmptyObject(jsondata.data)==true){
    var content = [];
    $("#box_data").val(JSON.stringify(content));
    table_data();

}else {
    var content = jsondata.data.School_List;
    //    alert(JSON.stringify(content));
    $("#box_data").val(JSON.stringify(content));
    table_data();
}


//                    }else {
//                        var content = jsondata.data.School_List;
//                        //    alert(JSON.stringify(content));
//                        $("#box_data").val(JSON.stringify(content));
//                        table_data();
//                    }




                }else {

                    $("#query_school_name").val("");
                    $("#selProvince option[value='0']").attr("selected", "selected");
                    $("#selCity option[value='0']").attr("selected", "selected");
                    $("#selDistrict option[value='0']").attr("selected", "selected");
                    $("#selProvince option[value='0']").removeAttr("selected");
                    $("#selCity option[value='0']").removeAttr("selected");
                    $("#selDistrict option[value='0']").removeAttr("selected");
                }
            }
    });

    });

    $("#add_school").on('click',function(){
        $('#add_school_modal').modal('show')
    });

    $("#edit_school").on('click',function(){
        var selects = $table.bootstrapTable('getSelections');
        alert(JSON.stringify(selects));
        if(selects.length==0){
            alert("请选择编辑信息");
            return
        }
        $.map(selects, function (row) {
        $("#edit_school_name").val(row.school_name);
            $("#edit_school_admin").val(row.name);
            $("#edit_school_mobile").val(row.phone);
            $("#edit_box_id").val(row.id);
            $("#edit_selProvince option").each(function(){
                if($(this).text() == row.school_position.split(",")[0]){
                    $(this).attr("selected","selected");
                    var one_val=$(this).val();
                }
                $.each(cityJson, function(k, p) {
                    // 直辖市处理.|| p.parent == selValue，直辖市为当前自己
                    if (p.id == one_val || p.parent == one_val) {
                        var option = "<option value='" + p.id + "'>" + p.city + "</option>";
                        $("#edit_selCity").append(option);
                    }
                });

            });

            $("#edit_selCity option").each(function(){
                if($(this).text() == row.school_position.split(",")[1]){
                    $(this).attr("selected","selected");
                    var two_val=$(this).val();
                    alert(two_val);
                }
                $.each(countyJson, function(k, p) {
                    // 直辖市处理.|| p.parent == selValue，直辖市为当前自己
                    if ( p.parent == two_val) {
                        var option = "<option value='" + p.id + "'>" + p.county + "</option>";
                        $("#edit_selDistrict").append(option);
                    }
                });
            });

//            $("#edit_selCity option").each(function(){
//                if($(this).text() == row.school_position.split(",")[1]){
//                    $(this).attr("selected","selected");
//                }
//            });

            $("#edit_selDistrict option").each(function(){
                if($(this).text() == row.school_position.split(",")[2]){
                    $(this).attr("selected","selected");
                }
            });

        })
        $('#edit_school_modal').modal('show')
    });


$("#add_school_submit").on('click',function(){
    var  add_province=$("#add_province option:selected").text();
    var  add_city=$("#add_city option:selected").text();
    var  add_county=$("#add_county option:selected").text();
    var add_school_name=$.filterSpaces($("#add_school_name").val());
    var add_school_admin=$.filterSpaces($("#add_school_admin").val());
    var add_school_mobile=$.filterSpaces($("#add_school_mobile").val());
    var  school_address=add_province+add_city+add_county;

    if($("#add_province option:selected").val()==0){
alert("请输入地址省");
        return
    }
    if($("#add_city option:selected").val()==0){
        alert("请输入地址市");
        return
    }
    if($("#add_county option:selected").val()==0){
        alert("请输入地址区");
        return
    }
if(add_school_name.length==0){
    alert("请输入学校名字");
    return
}
    if(add_school_admin.length==0){
        alert("请输入管理员名字");
        return
    }
    if(add_school_mobile.length==0){
        alert("请输入管理员手机号");
        return
    }else if($.cell_phone(add_school_mobile)==false){
        alert("输入的手机号格式不正确");
        return
    }

alert(add_province);
    alert(add_city);
    alert(add_county);
    alert(add_school_name);
    alert(add_school_admin);
    alert(add_school_mobile);
    alert(school_address);

    $.ajax({
        url: '/school/add_school',
        type: 'post',
        dataType: 'json',
        contentType: "application/json",
        data: JSON.stringify({
            school_name:add_school_name,
             school_position:school_address,
             long_latitude_range:"",
            phone:add_school_mobile,
            name:add_school_admin
        }),

        success: function(data) {
            alert(data);
            if (data.success == 0) {
                $('#add_school_modal').modal('hide')
                infolist();
            }
        }
    });

});


    $("#edit_school_submit").on('click',function(){
        var  edit_selProvince=$("#edit_selProvince option:selected").text();
        var  edit_selCity=$("#edit_selCity option:selected").text();
        var  edit_selDistrict=$("#edit_selDistrict option:selected").text();
        var edit_school_name=$.filterSpaces($("#edit_school_name").val());
        var edit_school_admin=$.filterSpaces($("#edit_school_admin").val());
        var edit_school_mobile=$.filterSpaces($("#edit_school_mobile").val());
        var  edit_school_address=edit_selProvince+','+edit_selCity+','+edit_selDistrict;
        var edit_box_id=$("#edit_box_id").val();
        if(edit_selProvince=="请选择"){
            alert("请输入地址省");
            return
        }
        if(edit_selCity=="请选择"){
            alert("请输入地址市");
            return
        }
        if(edit_selDistrict=="请选择"){
            alert("请输入地址区");
            return
        }
        if(edit_school_name.length==0){
            alert("请输入学校名字");
            return
        }
        if(edit_school_admin.length==0){
            alert("请输入管理员名字");
            return
        }
        if(edit_school_mobile.length==0){
            alert("请输入管理员手机号");
            return
        }else if($.cell_phone(edit_school_mobile)==false){
            alert("输入的手机号格式不正确");
            return
        }
alert(edit_school_mobile);
        alert(edit_school_admin);
        $.ajax({
            url: '/school/'+edit_box_id+'/modify_school',
            type: 'post',
            dataType: 'json',
            contentType: "application/json",
            data: JSON.stringify({
                school_name:edit_school_name,
                school_position:edit_school_address,
                long_latitude_range:"",
                phone:edit_school_mobile,
                name:edit_school_admin
            }),

            success: function(data) {
                if (data.success == 0) {

                    $('#edit_school_modal').modal('hide')
                    infolist();

                }
            }
        });

    });

    $("#delete_school").on('click',function(){
        var selects = $table.bootstrapTable('getSelections');
        if(selects.length==0){
            alert("请选择信息");
            return
        }
        $.map(selects, function (row) {
            $("#delete_school_id").val(row.id);
        })
        $('#delete_school_modal').modal('show');
    });


    $("#delete_school_submit").on('click',function(){
      var  delete_school_id=$("#delete_school_id").val();
        $.ajax({
            url: '/school/'+delete_school_id+'/delete_school ',
            type: 'delete',
            dataType: 'json',
            contentType: "application/json",
            data: JSON.stringify({

            }),
            success: function(data) {
                if (data.success == 0) {
                    $('#delete_school_modal').modal('hide')
                    infolist();
                }
            }
        });
    })




    $("#info_school").on('click',function(){
        var selects = $table.bootstrapTable('getSelections');
        if(selects.length==0){
            alert("请选择信息");
            return
        }
        $.map(selects, function (row) {

            parent.location.href="/map_school_info?school_id="+row.id;
        })

    });






    //部门
    //添加部门
    function add_info_school() {
        if($("#add_province option:selected").val()==0){
alert("请填写地址省");
            return
        }else if($("#add_city option:selected").val()==0){
            alert("请填写地址城市");
            return
        }else if($("#add_county option:selected").val()==0){
        alert("请填写地址区");
            return
    }
        var add_school_name=$("#add_school_name").val();
   if(add_school_name.length==0){
       alert("请输入学校名称");
       return
   }
var add_school_admin=$("#add_school_admin").val();
        if(add_school_admin.length==0){
            alert("请输入学校管理员名字");
            return
        }
        var add_school_mobile=$("#add_school_mobile").val();
        if(add_school_mobile.length==0){
            alert("请输入学校管理员手机号");
            return
        }

      var   school_title_length=$(".school_title").size();
        if(school_title_length==0){
          $("#school_longitude_one").val($("#school_longitude_zero").val());
            $("#school_latitude_one").val($("#school_latitude_zero").val());

            $("#school_name_one").val(add_school_name);
            $("#school_admin_one").val(add_school_admin);
            $("#school_mobile_one").val(add_school_mobile);
        }else if(school_title_length==1){
            $("#school_longitude_two").val($("#school_longitude_zero").val());
            $("#school_latitude_two").val($("#school_latitude_zero").val());

            $("#school_name_two").val(add_school_name);
            $("#school_admin_two").val(add_school_admin);
            $("#school_mobile_two").val(add_school_mobile);
        }else if(school_title_length==2){
            $("#school_longitude_three").val($("#school_longitude_zero").val());
            $("#school_latitude_three").val($("#school_latitude_zero").val());

            $("#school_name_three").val(add_school_name);
            $("#school_admin_three").val(add_school_admin);
            $("#school_mobile_three").val(add_school_mobile);
        }


        $("#add_province option[value=0]").attr("selected","selected");
        $("#add_city option[value=0]").attr("selected","selected");
        $("#add_county option[value=0]").attr("selected","selected");
        $("#add_school_name").val("");
        $("#add_school_admin").val("");
        $("#add_school_mobile").val("");

        $("#add_province option[value=0]").removeAttr("selected");
        $("#add_city option[value=0]").removeAttr("selected");
        $("#add_county option[value=0]").removeAttr("selected");
        add_one_school(add_school_name);

    }


    //动态添加部门函数
    function add_one_school(add_school_name) {
        var   school_title_length=$(".school_title").size();
        alert($(".school_title").size());
        //判断下拉内容是否为空值
        if( school_title_length ==3 ) {
            alert("校区只能最多添加3个");
            return ;
        }
//获取集合
//        var root = $('#add_school_info')[0];
//        //禁止重复添加
//        //遍历出集合root.children[i].getAttribute("name")里面的name值，如果等于添加ID的值，表示重复停止添加
//        for( var i = 0; i < root.children.length; i++ ) {
//
//            if( root.children[i].getAttribute("name") == department_id ) {
//                return ;
//            }
//        }

alert("1111111");


        var strHtml = '';

//        strHtml += '  <div class="input-group" style="margin-top: 20px">';
//        strHtml += '<div class="col-md-4">';
//        strHtml +='<div class="input-group">';
//        strHtml += '<span class="input-group-addon">省</span>';
//        strHtml += '<select class="form-control" id="edit_selProvince" name="edit_selProvince" >';
//        strHtml += '<option value="请选择">请选择</option>';
//        strHtml += '</select>';
//        strHtml += '</div>';
//        strHtml +='</div>';
//        strHtml +='<div class="col-md-4">';
//        strHtml +='<div class="input-group">';
//        strHtml +='<span class="input-group-addon">市</span>';
//        strHtml +='<select class="form-control" id="edit_selCity" name="edit_selCity">';
//        strHtml += '<option value="请选择">请选择</option>';
//        strHtml +='</select>';
//        strHtml += '</div>';
//        strHtml += '</div>';
//        strHtml +='<div class="col-md-4">';
//        strHtml +='<div class="input-group">';
//        strHtml += '<span class="input-group-addon">区</span>';
//        strHtml += '<select class="form-control" id="edit_selDistrict" name="edit_selDistrict">';
//        strHtml += '<option value="请选择">请选择</option>';
//        strHtml +=' </select>';
//        strHtml +=' </div>';
//        strHtml +='</div>';
//        strHtml +='</div>';
//        strHtml += '</br>';
//        strHtml += '<div class="input-group">';
//        strHtml += '<span class="input-group-addon">学校名称：</span>';
//        strHtml +='<input type="text" class="form-control"  id="edit_school_name" placeholder="请输入学校名称">';
//        strHtml +='</div>';
//        strHtml += '</br>';
//
//        strHtml +='<div class="input-group">';
//        strHtml +='<div class="col-md-6">';
//        strHtml +='<div class="input-group" style="width: 99%;">';
//        strHtml +=' <span class="input-group-addon">学校管理员：</span>';
//        strHtml +='<input type="text" class="form-control"  id="edit_school_admin" placeholder="请输入管理员名字">';
//        strHtml +='</div>';
//        strHtml +='</div>';
//
//        strHtml +='<div class="col-md-6">';
//        strHtml +='<div class="input-group">';
//        strHtml +='<span class="input-group-addon">管理员手机：</span>';
//        strHtml +='<input type="text" class="form-control"  id="edit_school_mobile" placeholder="请输入管理员手机">';
//        strHtml +='</div>';
//        strHtml +='</div>';
//        strHtml +='</div>'

        strHtml += '       <tr class="active" name="'+add_school_name+'" >';
        strHtml += '            <td class="col-md-9 school_title">'+add_school_name+'</td>';
        strHtml += '            <td>';
        strHtml += '                <a class="btn btn-link" style="color:OrangeRed;" onclick="on_delete_school(&quot;'+add_school_name+'&quot;);">';
        strHtml += '                   <i class="glyphicon glyphicon-minus icon-white"></i>移出';
        strHtml += '                </a>';
        strHtml += '            </td>';
        strHtml += '       </tr>';

        $('#add_school_info').append(strHtml);

    }

    //删除部门
    function on_delete_school(idx) {
        var root = $('#add_school_info')[0];

        for( var i = 0; i < root.children.length; i++ ) {
            if( root.children[i].getAttribute("name") == idx ) {
                root.children[i].remove();
            }
        }


    }

    function table_data() {
        var table_data = JSON.parse($("#box_data").val());
        // var  table_data=$("box_data").val();
        $table = $('#table').bootstrapTable({

            data: table_data,
            // url: '/table/123',
            // method: 'post',
            dataType: "json",
            //----选填----//
            //设置高度
            height: 500,

            pagination: true,
            pageSize: 10,
            pageList: [5, 10, 15, 20],
            sidePagination: "client",


            pageNumber: 1,
            sortable: true,
            sortOrder: "desc",

            clickToSelect: true,
            striped: true,

            //功能工具
            singleSelect: false,

            searchOnEnterKey: false,

//成功时执行函数
            //       onLoadSuccess:function(data){},
            onLoadSuccess: function (aa, bb, cc) {

            },

            //错误时执行函数
            onLoadError: function (status) {
                alert("错误");
            },


            idField: undefined,
            columns: [
                //附加表头，

                {
                    formatter: function (value, row, index) {
                        return index + 1;
                    }
                },
                {
                    //单选
                    radio: true,

                    //多选
                    // checkbox:true,
                },
                {
                    title: '学校名称',
                    field: 'school_name',
                    align: 'center',
                    valign: 'middle',
                    //  rowspan: 2

                },
                {
                    title: '所在地区',
                    field: 'school_position',
                    align: 'center',
                    valign: 'middle',
                },
                {
                    title: '管理员姓名',
                    field: 'name',
                    align: 'center',
                    valign: 'middle',
                },
                {
                    title: '管理员手机',
                    field: 'phone',
                    align: 'center',
                    valign: 'middle',
                },
                {
                    title: '学校坐标',
                    field: 'long_latitude_range',
                    align: 'center',
                    valign: 'middle',
                    formatter: function (value, row, index) {
//                        var e = '<span>'+JSON.stringify(row.long_latitude_range[0].longitude)+'</span>';
//                        return e
                    if (row.long_latitude_range[0].longitude == "") {
                        var e = '<a onclick="window_home(&quot;添加坐标&quot;,&quot;/map_add_range?id='+row.id+'&longitude=123.432259&latitude=41.811153&quot;)">添加坐标</a>';
                        return e
                    }
                    if (row.long_latitude_range[0].longitude!="") {
                        var e = '<a onclick="window_home(&quot;查看坐标&quot;,&quot;/map_edit_range?id='+row.id+'&quot;)">查看</a>';
                        return e
                    }
                }
                },
//            {
//                title: '根据数字判状态',
//                field: 'state',
//                align: 'center',
//                valign: 'middle',
//                formatter: function (value, row, index) {
//                    if (row.state == 1) {
//                        var e = '<span style="color: red;">没通过</span>';
//                        return e
//                    }
//                    if (row.state == 2) {
//                        var e = '<span style="color: blue;">已通过</span>;'
//                        return e
//                    }
//                    if (row.state == 3) {
//                        var e = '<span style="color:green;">审核中</span>;'
//                        return e
//                    }
//                }
//
//            },

            ]

        });
    }
</script>
<script type="text/javascript">
    $(function() {
        $.each(provinceJson, function(k, p) {
            var option = "<option value='" + p.id + "'>" + p.province + "</option>";
            $("#selProvince").append(option);
        });
        $("#selProvince").change(function() {
            var selValue = $(this).val();
            $("#selCity option:gt(0)").remove();
            $.each(cityJson, function(k, p) {
                // 直辖市处理.|| p.parent == selValue，直辖市为当前自己
                if (p.id == selValue || p.parent == selValue) {
                    var option = "<option value='" + p.id + "'>" + p.city + "</option>";
                    $("#selCity").append(option);
                }
            });
        });
        $("#selCity").change(function() {
            var selValue = $(this).val();
            $("#selDistrict option:gt(0)").remove();
            $.each(countyJson, function(k, p) {
                if (p.parent == selValue) {
                    var option = "<option value='" + p.id + "'>" + p.county + "</option>";
                    $("#selDistrict").append(option);
                }
            });
        });









        $.each(provinceJson, function(k, p) {
            var option = "<option value='" + p.id + "'>" + p.province + "</option>";
            $("#edit_selProvince").append(option);
        });
        $("#edit_selProvince").change(function() {
            var selValue = $(this).val();
            $("#edit_selCity option:gt(0)").remove();
            $.each(cityJson, function(k, p) {
                // 直辖市处理.|| p.parent == selValue，直辖市为当前自己
                if (p.id == selValue || p.parent == selValue) {
                    var option = "<option value='" + p.id + "'>" + p.city + "</option>";
                    $("#edit_selCity").append(option);
                }
            });
        });
        $("#edit_selCity").change(function() {
            var selValue = $(this).val();
            $("#edit_selDistrict option:gt(0)").remove();
            $.each(countyJson, function(k, p) {
                if (p.parent == selValue) {
                    var option = "<option value='" + p.id + "'>" + p.county + "</option>";
                    $("#edit_selDistrict").append(option);
                }
            });
        });


    });


    function window_home(title, url){
       parent.addTab(title,url);
    }

function infolist(){
    $('#table').bootstrapTable('destroy');
    $.ajax({
        url: '/school/get_schoollist',
        type: 'get',
        dataType: 'json',
        contentType: "application/json",
        data: JSON.stringify({
        }),
        success: function (data) {
            if(data.success==0){
                var jsondata=JSON.parse(JSON.stringify(data));
                alert(JSON.stringify(data));
                var content=jsondata.data.School_List;
                //    alert(JSON.stringify(content));
                $("#box_data").val(JSON.stringify(content));
                table_data();
            }else {
                alert("获取数据失败");
            }

        },
        error: function(){
            alert("获取数据失败");
        }
    });
}

//    function isEmptyObject(e) {
//        var t;
//        for (t in e)
//            return !1;
//        return !0
//    }
</script>
</body>
</html>
